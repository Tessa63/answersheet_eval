<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluation Report</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <div class="container">

        <div class="score-summary">
            <div class="score-label">Total Score</div>
            <div class="total-score">{{ exam_data.total_score }}</div>
            <div class="max-score">out of {{ exam_data.max_score }}</div>
            {% if exam_data.max_score > 0 %}
            <div class="score-percent" style="font-size: 1rem; color: rgba(255,255,255,0.8); margin-top: 8px;">
                {{ ((exam_data.total_score / exam_data.max_score) * 100) | round(1) }}%
            </div>
            {% endif %}
        </div>

        <div class="question-list">
            {% for item in exam_data.breakdown %}
            {% set ratio = item.score / item.max_marks if item.max_marks > 0 else 0 %}
            {% set score_class = 'score-high' if ratio >= 0.8 else 'score-med' if ratio >= 0.5 else 'score-low' %}
            {% set is_challenge = item.type == 'challenge' %}
            {% set opacity_class = 'unselected' if item.selected == False or is_challenge else '' %}

            <div class="question-card {{ score_class }} {{ opacity_class }}">
                <div class="q-score-box">
                    <span class="q-score-val">{{ item.score }}</span>
                    <span class="q-score-max">/ {{ item.max_marks }}</span>
                </div>

                <div class="q-content">
                    <div class="q-header">
                        <div class="q-title">Q{{ item.question }}</div>
                        {% if is_challenge %}
                        <span class="tag-warning"
                            style="background: #6c63ff22; color: #6c63ff; border: 1px solid #6c63ff55;">üèÜ Challenge
                            (Not Counted)</span>
                        {% elif item.selected == False %}
                        <span class="tag-warning">Not Counted (OR Alternative)</span>
                        {% elif item.type == 'optional' %}
                        <span class="tag" style="background: #e0f2fe; color: #0284c7;">OR Question (Selected)</span>
                        {% endif %}
                    </div>
                    <div class="q-feedback">
                        {{ item.feedback }}
                    </div>
                    {% if item.details %}
                    <div class="q-meta">
                        <span class="tag">Similarity: {{ item.details.similarity }}</span>
                        <span class="tag">Coverage: {{ item.details.concept_coverage }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <div style="text-align: center; margin-top: 40px;">
            <a href="/" class="btn-secondary">Evaluate Another</a>
        </div>
    </div>

</body>

</html>